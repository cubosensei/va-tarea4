<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Assignment 4 | Visual Analytics</title>

  <!-- Materialize CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  <!-- D3 -->
  <script type="text/javascript" src="libraries/d3/d3.min.js"></script>

  <!-- Internal -->
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col s12">
        <div class="card">
          <div class="card-image">
            <img src="assets/img/city.jpg">
            <span class="card-title">Let's roll on sundays</span>
          </div>
          <div class="card-content">
            <p>Thievery in general is a concern to every community, in Colombia this fenomena has been increasing year after year. In this case the graphics represent the amount of motorcycle thievery reports since january 2010 to september 2018.</p>
            <p>Data was published by <a href="https://www.policia.gov.co/" target="_blank">Policia Nacional de Colombia</a>.</p>
          </div>
          <div class="card-action">
            <p>Data source:</p>
            <a href="https://www.datos.gov.co/Seguridad-y-Defensa/Delito-Hurto-Motocicletas/khgh-fxad" class="btn blue" target="_blank">2010</a>
            <a href="https://www.datos.gov.co/Seguridad-y-Defensa/Delito-hurto-de-motocicletas/r84m-cnr3" class="btn blue" target="_blank">2011</a>
            <a href="https://www.datos.gov.co/Seguridad-y-Defensa/Delito-Hurto-De-Motocicletas/a5gc-b6k9" class="btn blue" target="_blank">2012</a>
            <a href="https://www.datos.gov.co/Seguridad-y-Defensa/Delito-Hurto-De-Motocicletas/tgae-d6ih" class="btn blue" target="_blank">2013</a>
            <a href="https://www.datos.gov.co/Seguridad-y-Defensa/Delito-Hurto-De-Motocicletas/ya9q-jbhx" class="btn blue" target="_blank">2014</a>
            <a href="https://www.datos.gov.co/Seguridad-y-Defensa/Delito-Hurto-Motocicletas/p6u4-rfsp" class="btn blue" target="_blank">2015</a>
            <a href="https://www.datos.gov.co/Seguridad-y-Defensa/Hurto-de-motocicletas-2016/nw2j-xsxp" class="btn blue" target="_blank">2016</a>
            <a href="https://www.datos.gov.co/Seguridad-y-Defensa/Hurto-de-motocicletas-2017/sv23-z8wd" class="btn blue" target="_blank">2017</a>
            <a href="https://www.policia.gov.co/contenido/hurto-motocicletas-2018-0" class="btn blue" target="_blank">2018</a>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col s12">
        <div class="card yellow lighten-4">
          <div class="card-content">
            <p><span class="badge"><i class="material-icons left">filter_list</i></span>Hover your mouse over the squares to get more information and use the following select to filter the results by department <div class="input-field col s12"><select id="departments"><option value="All" selected>All</option></select><label>Department</label></div></p>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col s12">
        <div class="card">
          <div class="card-content">
            <span class="card-title"><span class="badge"><i class="material-icons left">insert_chart</i></span> Motorcycles thievery in Colombia</span>
            <div id="chart1" class="progress"><div class="indeterminate"></div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <hr>
  
  <div class="container">
    <div class="row">
      <h2 class="section-title">About the vis</h2>
      <div class="col s12 m4">
        <div class="card">
          <div class="card-image red darken-3 noimage">
            <span class="card-title">What</span>
          </div>
          <div class="card-content">
            <p>Dataset Type: Temporal</p>
            <p>Items: Motorcycle thievery report</p>
            <p>Attributes: 
              <ol>
                <li>Date & time (Temporal)</li>
                <li>Department (Categorical)</li>
                <li>Count* (Ordered, Quantitative)</li>
              </ol>
            </p>
            <p><small>*Derived</small></p>
          </div>
        </div>
      </div>
      <div class="col s12 m4">
        <div class="card">
          <div class="card-image yellow darken-3 noimage">
            <span class="card-title">Why</span>
          </div>
          <div class="card-content">
            <ul class="browser-default">
              <li>Overview the behaviour of motorcycles thievery reports over time. <b>(Summarize - Trends)</b></li>
              <li>Identify possible peaks in specific days. <b>(Identify - Outliers)</b></li>
              <li>Compare the overall behaviour of motorcycles thievery reports between years. <b>(Compare - Features)</b></li>
              <li>*Derive the amount of thievery reports per day. <b>(Derive - Features)</b></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col s12 m4">
        <div class="card">
          <div class="card-image green darken-1 noimage">
            <span class="card-title">How</span>
          </div>
          <div class="card-content">
            <p>
              <ul>
                <li><ul>
                  <li>[1] (Days) Encode: Arrange, Separate, Order & Align.</li>
                  <li>[1] Facet: Juxtapose.</li>
                  <li>[3] Encode: Arrange, Express.</li>
                  <li>[3] Map: Color (saturation) .</li>
                  <li>[2] Reduce: Filter.</li>
                </ul></li>
                <li>Mark: Shape.</li>
                <li>Channels:
                  <ul class="browser-default">
                    <li>[1] Position.</li>
                    <li>[3] Color (saturation).</li>
                  </ul></li>
              </ul>
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col s12">
        <div class="card">
          <div class="card-content">
            <span class="card-title">Insights</span>
            <ul class="browser-default">
              <li>During easter week, on wednesday, thursday and friday motorcycles thievery reduces.</li>
              <li>In general, motorcycles thievery reduces on sundays.</li>
              <li>There are usually more reports in january 1st than december 31th.</li>
              <li>2016 was the year in which the most robberies were reported.</li>
              <li>One month after the rise of IVA to 19% in 2017, motorcycles thievery reports reduced.</li>
              <li>Motorcycles thievery reports increased after the announce of SOAT prices in january 2018.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col s12">
        <div class="card">
          <div class="card-content">
            <span class="card-title">Used Technologies</span>
            <ul class="browser-default">
              <li>D3: <a href="https://d3js.org" target="_blank">https://d3js.org</a></li>
              <li>Materialize: <a href="https://materializecss.com" target="_blank">https://materializecss.com</a></li>
              <li>Microsoft Excel (to derive data)</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>

  <footer class="page-footer grey darken-4">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">Visual Analytics</h5>
          <p class="grey-text text-lighten-2">This visualization was developed for the <a href="http://johnguerra.co/classes/visual_analytics_fall_2018/" target="_blank">Visual Analytics</a> class (2018-20) at <a href="https://uniandes.edu.co/" target="_blank">Universidad de los Andes</a>.</p>
        </div>
        <div class="col l4 offset-l2 s12">
          <h5 class="white-text">Related Content</h5>
          <ul>
            <li><a href="https://github.com/cubosensei/va-tarea4" target="_blank">Source Code</a></li>
            <li><a href="#!" target="_blank">Slides</a></li>
            <li><a href="#!" target="_blank">Youtube Video</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright black">
      <div class="container">
      2018 MIT Licenced Content by <a href="http://www.manalco.co" target="_blank">Manuel Alvarado</a>
      </div>
    </div>
  </footer>
  <script type="text/javascript">
    //D3
    var rawData;
    var width = d3.select("#chart1").node().getBoundingClientRect().width-80;
    var cellSize = width/52;
    var height = cellSize * 9;
    var countDay = d => (d.getDay() + 6) % 7;
    function pathMonth(t) {
      const n = 7;
      const d = Math.max(0, Math.min(n, countDay(t)));
      const w = d3.timeMonday.count(d3.timeYear(t), t);
      return `${d === 0 ? `M${w * cellSize},0`
          : d === n ? `M${(w + 1) * cellSize},0`
          : `M${(w + 1) * cellSize},0V${d * cellSize}H${w * cellSize}`}V${n * cellSize}`;
    }
    var format = d3.format("+.2%");
    var formatDate = d3.timeFormat("%x");
    var formatDay = d => ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];
    var formatMonth = d3.timeFormat("%b");

    d3.csv('assets/data/Hurto_de_motocicletas_2010-2017.csv').then(
      function(data) {
        data.sort( (a,b) => d3.ascending(new Date(a.fecha), new Date(b.fecha)));
        rawData = data;console.log(data);

        var departments = data.columns.splice(1,32);
        departments.forEach(function(d,i){
          d3.select('#departments')
            .append("option")
            .attr("value", d)
            .text(d);
        });
        var elems = document.querySelectorAll('select');
        var instances = M.FormSelect.init(elems);
        drawCalendar();
        d3.select("#chart1").attr("class","");
      }
    );

    function formatYear(s){
      var d = new Date(s);
      return d.getFullYear();
    }

    function drawCalendar(){
      var filter = d3.select("#departments").property("value");
      
      width = d3.select("#chart1").node().getBoundingClientRect().width-80;
      cellSize = width/52;
      height = cellSize * 9;
      d3.select("#chart1").html("");
      var color = d3.scaleSequential(d3.interpolateBlues).domain([0, d3.max(rawData, d=> +d[filter])]);

      var years = d3.nest()
        .key(d => formatYear(d.fecha))
        .entries(rawData);
      
      var svg = d3.select("#chart1")
        .append("svg")
        .style("font", "10px sans-serif")
        .style("width", "100%")
        .style("height", height*years.length);

      const year = svg.selectAll("g")
          .data(years)
          .enter().append("g")
            .attr("transform", (d, i) => `translate(40,${height * i + cellSize * 1.5})`);
      year.append("text")
            .attr("x", -5)
            .attr("y", -5)
            .attr("font-weight", "bold")
            .attr("text-anchor", "end")
            .text(d => d.key);

        year.append("g")
            .attr("text-anchor", "end")
          .selectAll("text")
          .data((d3.range(7)).map(i => new Date(1995, 0, i)))
          .enter().append("text")
            .attr("x", -5)
            .attr("y", d => (countDay(d) + 0.5) * cellSize)
            .attr("dy", "0.31em")
            .text(formatDay);

        year.append("g")
          .selectAll("rect")
          .data(d => d.values)
          .enter().append("rect")
            .attr("width", cellSize - 1)
            .attr("height", cellSize - 1)
            .attr("x", d => d3.timeMonday.count(d3.timeYear(new Date(d.fecha)), new Date(d.fecha)) * cellSize + 0.5)
            .attr("y", d => countDay(new Date(d.fecha)) * cellSize + 0.5)
            .attr("fill", d => color(d[filter]))
          .append("title")
            .text(d => `${formatDate(new Date(d.fecha))}: ${d[filter]} reports`);

        const month = year.append("g")
          .selectAll("g")
          .data(d => d3.timeMonths(d3.timeMonth(new Date(d.values[0].fecha)), new Date(d.values[d.values.length - 1].fecha)))
          .enter().append("g");

        month.filter((d, i) => i).append("path")
            .attr("fill", "none")
            .attr("stroke", "#fff")
            .attr("stroke-width", 3)
            .attr("d", pathMonth);

        month.append("text")
            .attr("x", d => d3.timeMonday.count(d3.timeYear(d), d3.timeMonday.ceil(d)) * cellSize + 2)
            .attr("y", -5)
            .text(formatMonth);
    }

    d3.select("#departments")
      .on("change", function(){
        drawCalendar();
      });

    window.onresize = function(event) {
      drawCalendar();
    }
  </script>
</body>